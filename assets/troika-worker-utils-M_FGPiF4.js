function M(){var e=Object.create(null);function a(n,t){var o=n.id,i=n.name,u=n.dependencies;u===void 0&&(u=[]);var r=n.init;r===void 0&&(r=function(){});var f=n.getTransferables;if(f===void 0&&(f=null),!e[o])try{u=u.map(function(s){return s&&s.isWorkerModule&&(a(s,function(v){if(v instanceof Error)throw v}),s=e[s.id].value),s}),r=c("<"+i+">.init",r),f&&(f=c("<"+i+">.getTransferables",f));var d=null;typeof r=="function"?d=r.apply(void 0,u):console.error("worker module init function failed to rehydrate"),e[o]={id:o,value:d,getTransferables:f},t(d)}catch(s){s&&s.noLog||console.error(s),t(s)}}function l(n,t){var o,i=n.id,u=n.args;(!e[i]||typeof e[i].value!="function")&&t(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var r=(o=e[i]).value.apply(o,u);r&&typeof r.then=="function"?r.then(f,function(d){return t(d instanceof Error?d:new Error(""+d))}):f(r)}catch(d){t(d)}function f(d){try{var s=e[i].getTransferables&&e[i].getTransferables(d);(!s||!Array.isArray(s)||!s.length)&&(s=void 0),t(d,s)}catch(v){console.error(v),t(v)}}}function c(n,t){var o=void 0;self.troikaDefine=function(u){return o=u};var i=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+t+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(u){console.error(u)}return URL.revokeObjectURL(i),delete self.troikaDefine,o}self.addEventListener("message",function(n){var t=n.data,o=t.messageId,i=t.action,u=t.data;try{i==="registerModule"&&a(u,function(r){r instanceof Error?postMessage({messageId:o,success:!1,error:r.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof r=="function"}})}),i==="callModule"&&l(u,function(r,f){r instanceof Error?postMessage({messageId:o,success:!1,error:r.message}):postMessage({messageId:o,success:!0,result:r},f||void 0)})}catch(r){postMessage({messageId:o,success:!1,error:r.stack})}})}function b(e){var a=function(){for(var l=[],c=arguments.length;c--;)l[c]=arguments[c];return a._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,l);throw new Error("Worker module function was called but `init` did not return a callable function")})};return a._getInitResult=function(){var l=e.dependencies,c=e.init;l=Array.isArray(l)?l.map(function(t){return t&&t._getInitResult?t._getInitResult():t}):[];var n=Promise.all(l).then(function(t){return c.apply(null,t)});return a._getInitResult=function(){return n},n},a}var k=function(){var e=!1;if(typeof window<"u"&&typeof window.document<"u")try{var a=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));a.terminate(),e=!0}catch(l){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+l.message+"]")}return k=function(){return e},e},W=0,E=0,p=!1,g=Object.create(null),m=Object.create(null),y=Object.create(null);function R(e){if((!e||typeof e.init!="function")&&!p)throw new Error("requires `options.init` function");var a=e.dependencies,l=e.init,c=e.getTransferables,n=e.workerId;if(!k())return b(e);n==null&&(n="#default");var t="workerModule"+ ++W,o=e.name||t,i=null;a=a&&a.map(function(r){return typeof r=="function"&&!r.workerModuleData&&(p=!0,r=R({workerId:n,name:"<"+o+"> function dependency: "+r.name,init:`function(){return (
`+w(r)+`
)}`}),p=!1),r&&r.workerModuleData&&(r=r.workerModuleData),r});function u(){for(var r=[],f=arguments.length;f--;)r[f]=arguments[f];if(!i){i=h(n,"registerModule",u.workerModuleData);var d=function(){i=null,m[n].delete(d)};(m[n]||(m[n]=new Set)).add(d)}return i.then(function(s){var v=s.isCallable;if(v)return h(n,"callModule",{id:t,args:r});throw new Error("Worker module function was called but `init` did not return a callable function")})}return u.workerModuleData={isWorkerModule:!0,id:t,name:o,dependencies:a,init:w(l),getTransferables:c&&w(c)},u}function L(e){m[e]&&m[e].forEach(function(a){a()}),g[e]&&(g[e].terminate(),delete g[e])}function w(e){var a=e.toString();return!/^function/.test(a)&&/^\w+\s*\(/.test(a)&&(a="function "+a),a}function I(e){var a=g[e];if(!a){var l=w(M);a=g[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+` **/

;(`+l+")()"],{type:"application/javascript"}))),a.onmessage=function(c){var n=c.data,t=n.messageId,o=y[t];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete y[t],o(n)}}return a}function h(e,a,l){return new Promise(function(c,n){var t=++E;y[t]=function(o){o.success?c(o.result):n(new Error("Error in worker "+a+" call: "+o.error))},I(e).postMessage({messageId:t,action:a,data:l})})}export{R as d,L as t};
